<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ArcGIS API Example</title>
<link rel="stylesheet" href="https://js.arcgis.com/4.21/esri/themes/light/main.css">
<script src="https://js.arcgis.com/4.21/"></script>
</head>
<body>
<div id="viewDiv" style="height: 100vh;"></div>
<script>
require([
   "esri/Map",
   "esri/views/MapView",
   "esri/layers/FeatureLayer",
   "esri/widgets/Sketch",
   "esri/geometry/Polyline",
   "esri/Graphic",
   "esri/geometry/geometryEngine",
   "esri/views/2d/draw/Draw",
   "esri/views/2d/interactive/snapping/SnappingOptions",
   "esri/views/2d/interactive/snapping/SnappingControls"
], function (
   Map, MapView, FeatureLayer, Sketch, Polyline, Graphic, geometryEngine, Draw, SnappingOptions, SnappingControls
) {
   const map = new Map({ basemap: "streets-navigation-vector" });
   const view = new MapView({
       container: "viewDiv",
       map: map,
       center: [114.109, 22.396], // Longitude, latitude
       zoom: 10
   });
   const trailLayer = new FeatureLayer({
       url: "https://rmaplite-map-uat.hkphub.com/arcgis_server/rest/services/Hosted/HikingTrailsinCountryParks_fortest_wfok/FeatureServer/0",
       authenticationInfo: {
           username: "portaladmin",
           password: "gis12345"
       }
   });
   map.add(trailLayer);
   const sketch = new Sketch({
       view: view,
       layer: trailLayer,
       creationMode: "update" // Allows drawing on existing features
   });
   view.ui.add(sketch, "top-right");
   // Configure snapping options
   const snappingOptions = new SnappingOptions({
       enabled: true, // Enable snapping
       selfEnabled: true, // Snap to the sketch itself
       featureEnabled: true, // Snap to features
       featureSources: [{ layer: trailLayer }] // Specify the layer to snap to
   });
   // Apply snapping options to the view
   const snappingControls = new SnappingControls({
       view: view,
       snappingOptions: snappingOptions
   });
   // Enable snapping for the sketch widget
   sketch.viewModel.snappingOptions = snappingOptions;
   // Handle mouse events (optional, for custom drawing logic)
   view.on("click", function (event) {
       // Logic to start drawing on existing line segment
   });
   view.on("mousedown", function (event) {
       // Capture the starting point and begin to draw
   });
   view.on("mousemove", function (event) {
       // Update the graphic as the mouse moves
   });
   view.on("mouseup", function (event) {
       // Finalize the drawing and add to the layer
   });
});
</script>
</body>
</html>
